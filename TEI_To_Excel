from openpyxl import Workbook
from lxml import etree
import xml.etree.ElementTree as eT
import os


def data_to_cell(list_item, path, ws, nb_row, nb_col):
    for element in root.findall(path, ns):
        list_item.append(element.text)
    row = nb_row
    col = nb_col
    for item in list_item:
        ws.cell(column=col, row=row, value=item)
        row += 1

# Creation of the file
wb = Workbook()
wb_filename = "../mapping_pliegos_metadata.xlsx"

# Creation of the sheet
ws1 = wb.active
ws1.title = "metadata"

folder = '/Users/elinaleblanc/Documents/Postdoctorat/Encodage/Moreno-TEI-files'

title_list = []

for f in os.listdir(folder):
    if f.endswith('.xml'):
        xml_path = os.path.join(folder, f)
        label, ext = os.path.splitext(f)

        ns = {'tei': 'http://www.tei-c.org/ns/1.0'}
        eT.register_namespace('', 'http://www.tei-c.org/ns/1.0')

        xml_tree = eT.parse(xml_path)
        root = xml_tree.getroot()

        data_to_cell(title_list, './/tei:fileDesc/tei:titleStmt/tei:title',ws1,1,1)

        '''for title in root.findall('.//tei:fileDesc/tei:titleStmt/tei:title', ns):
            title_list.append(title.text)

        row = 1
        column = 1
        for item in title_list:
            ws1.cell(column=column, row=row, value=item)
            row += 1'''

wb.save(filename=wb_filename)
