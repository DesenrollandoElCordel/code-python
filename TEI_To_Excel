from openpyxl import load_workbook
import xml.etree.ElementTree as eT
import os
import re

# Loading of the Excel file
wb = load_workbook(filename='../Index_Grabados_Varios.xlsx')

# Selection of the worksheet
ws1 = wb["metadata"]
# print(ws1['A2'].value)

# Folder with TEI Files
folder = '../Encodage/Varios-TEI-files/xml-files'

# Addition of data to XLSX worksheet
for f in os.listdir(folder):
    if f.endswith('.xml'):
        xml_path = os.path.join(folder, f)
        label, ext = os.path.splitext(f)

        ns = {'tei': 'http://www.tei-c.org/ns/1.0'}
        eT.register_namespace('', 'http://www.tei-c.org/ns/1.0')

        xml_tree = eT.parse(xml_path)
        root = xml_tree.getroot()

        printers = root.find(".//tei:publisher", ns)
        printer = printers.text

        for row in ws1.iter_rows(min_row=2, max_row=127, min_col=2, max_col=2):
            for cell in row:
                number_row = re.split("B", str(cell))
                c = cell.value
                if c == label:
                    name_cell = "G" + number_row[1][:-1]
                    ws1[name_cell] = printer
                    # print(cell, name_cell)

        # print(label + ": done")

wb.save(filename='../test.xlsx')

# To DO :  Faire la mÃªme chose avec les titres et les dates
